version: '3.8'

services:
  reagent-app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: reagent-app-dev
    # Next.js Dev サーバーを外部 (0.0.0.0) にバインド
    command: npx next dev -H 0.0.0.0 -p 3000
    # ソースコードをコンテナにマウントして即時反映
    volumes:
      - .:/app:rw
      # node_modules はコンテナ内のものを利用
      - /app/node_modules
    ports:
      - '3000:3000'
    environment:
      - NODE_ENV=development
      # host.docker.internal:5433 経由で本番 DB に接続
      - DATABASE_URL=postgresql://postgres:${DB_PASSWORD}@host.docker.internal:5433/reagent_db
      - HOST=0.0.0.0
      - PORT=3000
      - CHOKIDAR_USEPOLLING=true
      - CHOKIDAR_INTERVAL=100

volumes:
  reagent-db-data: